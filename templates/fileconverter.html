<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Files For All</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/cbec5c0848.js" crossorigin="anonymous"></script>
    <!-- <link rel="stylesheet" href="../styles/magnific-popup.css" /> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/magnific-popup.css')}}">
    <!-- <link rel="stylesheet" href="../styles/styles.css" /> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/styles.css')}}" />
    <!-- <link rel="shortcut icon" type="image/x-icon" href="../images/logo2.png" /> -->
    <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='images/logo2.png')}}" />
</head>
<body>
  <div class="hero-section">
    <video autoplay loop muted plays-inline class="back-video">
        <source src="{{ url_for('static', filename='images/filebackground.mp4')}}" type="video/mp4">
    </video>
    <nav>
      <a href="/"><img src="{{ url_for('static', filename='images/logo2.png')}}" class="logo" /></a>
      <ul>
        <li><a href="/urlpage">Url Downloader</a></li>
        <li><a href="/fileconverter">File Converter</a></li>
        <li><a href="/aboutus">About Us</a></li>
        <li><a href="/donate">Donate</a></li>
      </ul>
    </nav>
        <div class="content">
            <h1>File Converter</h1>
            <!-- Create the feature -->
            <form id="file-form" enctype="multipart/form-data">
              <div class="mb-3">
                <label for="formFile" class="form-label"></label>
                <input class="form-control" type="file" id="formFile">
              </div>
              <button type="button" id="next1" class="btn btn-primary m-5">Next</button>
              <div id="errorAlert" class="alert alert-danger" role="alert" style="display:none"></div>

              <select class="video-select" id="inputGroupSelect01" name="format1">
                <option value="MP4" selected>MP4</option>
                <option value="MOV">MOV</option>
                <option value="AVI">AVI</option>
                <option value="MKV">MKV</option>
                <option value="WebM">WebM</option>
                <option value="GIF">GIF</option>
              </select>
              
              <select class="image-select" id="inputGroupSelect02" name="format2">
                <option value="BMP" selected>BMP</option>
                <option value="EPS">EPS</option>
                <option value="GIF">GIF</option>
                <option value="PDF">PDF</option>
                <option value="IM">IM</option>
                <option value="JPG">JPG</option>
                <option value="MSP">MSP</option>
                <option value="PCX">PCX</option>
                <option value="PNG">PNG</option>
                <option value="PPM">PPM</option>
                <option value="TIFF">TIFF</option>
              </select>
              <button type="submit" class="btn btn-primary m-5" id="finish">Submit</button>
            </form>
            <div id="successPopup" style="display:none"></div>

        </div>
    </div>
    <section class="whypage" id="why-section">
        <div id="text-item">
            <h1>
              How Do You Use The File Converter?
                    </h1>
            <p>Lorem ipsum dolor, sit amet consectetur adipisicing elit. Nemo cum voluptatibus, odit sunt, veniam ea doloremque rem sed maiores iusto rerum non iure beatae consequuntur neque facere assumenda praesentium mollitia! Lorem ipsum dolor, sit amet consectetur adipisicing elit. Nemo cum voluptatibus, odit sunt, veniam ea doloremque rem sed maiores iusto rerum non iure beatae consequuntur neque facere assumenda praesentium mollitia!</p>
        </div>
        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
          <div class="carousel-inner">
            <div class="carousel-item active img-one">
              <img class="d-block w-100 " src="{{ url_for('static', filename='images/users.jpg')}}" alt="First slide">
            </div>
            <div class="carousel-item img-two">
              <img class="d-block w-100" src="{{ url_for('static', filename='images/users.jpg')}}" alt="Second slide">
            </div>
            <div class="carousel-item img-three">
              <img class="d-block w-100 " src="{{ url_for('static', filename='images/users.jpg')}}" alt="Third slide">
            </div>
          </div>
          <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>

          
    </section>
    <footer class="py-3 my-4">
        <ul class="nav justify-content-center border-bottom pb-3 mb-3">
          <li class="nav-item p-2"><a href="https://validator.w3.org/check?uri=referer"><button class="btn btn-dark">html validation</button></a> </li>
          <li class="nav-item p-2">        
          <a href="https://jigsaw.w3.org/css-validator/check/referer"><button class="btn btn-dark">css validation</button></a>
          </li>
        </ul>
        <p class="text-center text-muted">Â© 2023 Waghchoure Designs</p>
      </footer>
      <script src="{{ url_for('static', filename='scripts/jquery.magnific-popup.js')}}"></script>
      <script>
        $('#inputGroupSelect01').hide()
        $('#inputGroupSelect02').hide()
        $('#finish').hide()
        $('#errorAlert').hide()
        $("#next1").show();
        let g1 = false;
        let g2 = false;

        $(document).ready(function() {
          $('.img-one').magnificPopup({
            items: {
              src: "{{ url_for('static', filename='images/users.jpg')}}"
            },
            type: 'image' // this is default type
        });
        $('.img-two').magnificPopup({
          items: {
            src: "{{ url_for('static', filename='images/users.jpg')}}"
          },
          type: 'image' // this is default type
      });
      $('.img-three').magnificPopup({
        items: {
          src: "{{ url_for('static', filename='images/users.jpg')}}"
        },
        type: 'image' // this is default type
    });
    function isValueInDropdown(value, mySelect) {
      for (var i = 0; i < mySelect.options.length; i++) {
        if (mySelect.options[i].value === value) {
          return true; // Value found in the dropdown
        }
      }
      return false; // Value not found in the dropdown
    }
    $("#formFile").click(function(){
      $('#inputGroupSelect01').hide()
      $('#inputGroupSelect02').hide()
      $('#finish').hide()
      $('#errorAlert').hide()
      $("#next1").show();
    });

    $("#next1").click(function(){
      // Get the file input element 
      
      var fileVal=document.getElementById("formFile");
      var file = fileVal.value.split('.');
      file = file[file.length-1].toUpperCase();
      console.log(file)
      if (isValueInDropdown(file, inputGroupSelect01)){
        $('#errorAlert').hide();
        $('#inputGroupSelect01').show();
        $("#next1").hide();
        $('#finish').show();
        g1 = true;
      }
      else if (isValueInDropdown(file, inputGroupSelect02)){
        $('#errorAlert').hide();
        $('#inputGroupSelect02').show();
        $("#next1").hide();
        $('#finish').show();
        g2 = true;
        }
        else {
          $('#errorAlert').text("Error").show();
        }
    });

    $('#file-form').on('submit', function(event){
      event.preventDefault();
      $('#successPopup').hide();


      let fileInput = $('#formFile')[0].files[0];
      let formData = new FormData();
      formData.append('file', fileInput);
      
      if ($('#inputGroupSelect01').is(':visible')) {
          formData.append('convert_to', $('#inputGroupSelect01').val());
      } else if ($('#inputGroupSelect02').is(':visible')) {
          formData.append('convert_to', $('#inputGroupSelect02').val());
      } else {
          // Handle error here if no conversion format is selected
      }
      
      $.ajax({
          data: formData,
          type: "POST",
          url: "/convert",
          contentType: false,
          processData: false,
      })
        .done(function(data){
              if (data.error){
                $('#errorAlert').text(data.error).show();
                $('#successPopup').hide();
              }
              else {
                $('#successPopup').empty(); 
                let blob = new Blob([data], { "type": "video\/" + ($('#inputGroupSelect01').val()).toLowerCase() });
                let click = URL.createObjectURL(blob);
                let download = 'converted_file.' + ($('#inputGroupSelect01').val()).toLowerCase();

              var videoDiv = $('<div>', {
                  id: 'download_link',
                  class: 'download_link',
                  html: `
                     <a href=${click} download=${download}>Click here to download!</a>
                  `
              });
              $('#successPopup').append(videoDiv);
              $('#successPopup').addClass('spaced').show();
              $('#errorAlert').hide();
              $('#url-text').hide();
                // Handle the converted file response
                $('#errorAlert').hide();
                console.log(data);

            }
            });

    });

  });

      </script>
    </body>
    </html>